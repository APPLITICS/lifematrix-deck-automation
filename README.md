# Automated Slide Deck Generation from Survey Data (Phase 2 & 3)

This README describes the proposed architecture and logic for automating the creation of PowerPoint presentations from structured, preprocessed survey data. It outlines the data structure, slide generation pipeline, individual slide rendering functions, and known constraints based on initial analysis and discussions. This document corresponds to **Phase 2**, and a good starting point of **Phase 3** of the project.

## ðŸ§© Global Pipeline Structure

###  Inputs

- Raw Data collected from the application.

- **Instruction list (`instructions`)**  
  A parameterized list defining each slideâ€™s layout, chart type, metric, and optional subgroup slicing (e.g., by gender).
  Note that only one level of subsetting is supported; nested or multi-level subgroup definitions are not currently allowed, except for the horizontal bar charts, where it's needed (slide 70).
  
###  Core Logic

- The pipeline loops through the `instructions` list, identifying and calling the appropriate slide generation function for each entry.
- Each function receives the raw data and its specific instruction, processes and summarizes the data as needed, and generates the slide directly from the result.

This approach ensures flexibility, minimizes dependencies, and supports fast slide generation â€” ideal for both large-scale deck creation and real-time event use.

###  Example Code Usage

```r
# STEP 1: Preprocess the raw survey data
raw_data <- fread("raw_data.csv")

# STEP 2: Define global groups (used in slides),

focal_group        <- "Xilio"
comparison_group_1 <- "HBS"
comparison_group_2 <- "IWF"
# Up to 4 groups total (including the focal group)

# STEP 3: Define slide instructions (each element = one slide)
instructions <- list(
  # Slide 1: Density chart
  list(
    slide_type = "density_chart",
    metric     = "life_satisfaction",
    title      = "Life Satisfaction",
    unit       =  NULL,
    x_title        = "Life Satisfaction",
    y_title        = "Density",
    focal_group = list(name = focal_group, subset = "All"),
    comparison_groups = list(
      list(name = comparison_group_1, subset = "All"),
      list(name = comparison_group_2, subset = "All")
    )
  ),
  # Slide 2: Bar chart
  list(
    slide_type = "bar_chart",
    metric      = c("joy", "achievement", "meaningfulness"),
    title      = "IMPORTANCE OF JAM",
    unit       = "%",
    x_title        = NULL,
    y_title        = "% High Importance",
    focal_group = list(
      name   = focal_group,
      subset = list(title = "gender", value = "Female")
    ),
    comparison_groups = list(
      list(
      name = comparison_group_1,
      subset = list(title = "gender", value = "Female"))
    ),
    target = NULL,
    trend_line = FALSE
  )
  # ... More slides here
)

# STEP 4: Generate the presentation and save the visualized slides in Excel Data sheet (1 sheet per slide)
run_pipeline(data = raw_data, instructions = instructions)

```
### Example Of The Core Logic
```r
run_pipeline <- function(data, instructions) {
  for (instruction in instructions) {
    switch(
      instruction$slide_type,
      "bar_chart"     = generate_bar_slide(data, instruction),
      "density_chart" = generate_density_slide(data, instruction),
       #...
      stop("Unknown slide type: ", instruction$slide_type)
    )
  }
}
```
This structure keeps the logic clean, scalable, and easy to extend.
The pipeline will automatically map the `instructions` parameters (e.g. `slide_type`, `metric`, `focal_group`...) to the appropriate slide generation function (e.g., `generate_bar_slide()`).

## ðŸ§± Slide Generative Functions

Each slide is generated by a dedicated `generate_*_slide()` function based on its chart type. These functions handle both data processing and slide creation, making each slide fully self-contained.
The presentation includes 7 core chart types, each linked to its own function.

Below is a list with their names and example slide numbers:

| Slide Type                          | Function Name                        | Example Slides    |
| ----------------------------------- | ------------------------------------ | ----------------- |
| Density Chart                       | `generate_density_slide()`           | 3â€“5, 29â€“52, 57â€“58 |
| Bar Chart                           | `generate_bar_slide()`               | 8â€“22, 60â€“65       |
| Donut Chart                         | `generate_donut_slide()`             | 6â€“7, 59, 81â€“83    |
| Horizontal Bar Chart                | `generate_horizontal_bar_slide()`    | 53, 54, 69, 70    |
| Activity Slide (High/Low Value)     | `generate_activity_slide()`          | 23â€“28             |
| Multi-Line Comparison Chart         | `generate_line_comparison_slide()`   | 84â€“87             |
| Circle Value Summary                | `generate_circle_summary_slide()`    | 75â€“78             |

---

### A. Density Graphs with Average

**Used In**: Slides 3â€“5, 29â€“52, 57â€“58  

**Function**:  
```r
generate_density_slide(data, instruction)
```

#### Description

- Generates a density plot (along with the corresponding data in the sheet) for a given metric (e.g., `life_satisfaction`, `sleep_hours`) for the focal group.  
- The focal groupâ€™s average is marked with a vertical dashed line, while comparison group averages are highlighted in green annotation boxes for clear benchmarking

#### Characterstics of the `instruction` input

- `slide`: Slide number.
- `slide_type`: `"density_chart"`
- `metric`: Name of the targeted title to plot.
- `title`: Slide title.
- `unit`: Unit (e.g., `%`, `NULL`, `"hours"`).
- `x_title`: X-axis label.
- `y_title`: Y-axis label.
- `focal_group`: List with `name` and optional `subset` (1 level is allowed) - `NULL` for `subset` if no subsetting.
- `comparison_groups`: List of comparison groups or `NULL`.

#### Example `instructions` for Slide 3: Focal Group without Comparison Groups

```r
instructions <- list(
  list(
    slide             = 3,
    slide_type        = "density_chart",
    metric            = "life_satisfaction",
    title             = "Life Satisfaction",
    unit              = NULL,
    x_title           = "Life Satisfaction",
    y_title           = "Density",
    focal_group       = list(name = focal_group, subset = NULL),
    comparison_groups = NULL
  )
)
```

#### Example `instructions` for Slide 5: Focal Group without Comparison Groups

```r
instructions <- list(
  list(
    slide             = 3,
    slide_type        = "density_chart",
    metric            = "life_satisfaction",
    title             = "Life Satisfaction",
    unit              = NULL,
    x_title           = "Life Satisfaction",
    y_title           = "Density",
    focal_group       = list(name = focal_group, subset = NULL),
    comparison_groups = list(
      list(name = comparison_group_1, subset = list(title = "gender", value = "Women")),
      list(name = comparison_group_1, subset = list(title = "gender", value = "men"))
    ),
  )
)
```

---

### B. Bar Graphs

**Used In**: Slides 8â€“22 and similar  

**Function**:  
```r
generate_bar_slide(data, instruction)
```

#### Description

- Generates a grouped or stacked bar chart based on `metric` values across focal and comparison groups.
- The second comparison group is set to NA used intentionally as a placeholder to reserve layout space in the chart (Build Scenario).

#### Characterstics of the `instruction` input

- `slide`: Slide number.
- `slide_type`: `"bar_chart"`
- `metrics`: A vector of metrics to display.
- `title`: Slide title.
- `unit`: Unit (e.g. `"%"`, `"hours"`).
- `x_title`: X-axis title.
- `y_title`: Y-axis title.
- `legend`: Whether to show a legend.
- `focal_group`: List with `name` and optional `subset` (1 level is allowed) - `NULL` for `subset` if no subsetting.
- `comparison_groups`: List of group definitions. Use `name = NA` for placeholders.
- `target`: Optional reference lines.
- `trend_line`: Whether to include a trend line.
- `stacked`: Whether to stack bars instead of grouping.

#### Example `instructions` of Slide 12 with Focal Group Override and `NA` Comparison Slot

```r
instructions <- list(
  list(
    slide       = 12,
    slide_type  = "bar_chart",
    metric      = c("joy", "achievement", "meaningfulness"),
    title       = "IMPORTANCE OF JAM",
    unit        = "%",
    x_title     = NULL,
    y_title     = "% High Importance",
    legend      = TRUE,
    focal_group = list(
      name   = "Pillar",
      subset = list(title = "category", value = "VC")
    ),
    comparison_groups = list(
      list(name = comparison_group_1, subset = list(title = "gender", value = "Women")),
      list(name = NA,   subset = list(title = "category", value = "All"))
    ),
    target     = NULL,
    trend_line = FALSE,
    stacked    = FALSE
  )
)
```

---

### C. Donut Charts

**Used In**: Slides 6â€“7, 59, 81â€“83  

**Function**:  
```r
generate_donut_slide(data, instruction)
```

#### Description

Generates donut charts that display category proportions per group.

#### Characterstics of the `instruction` input

- `slide`: Slide number.
- `slide_type`: `"donut_chart"`
- `metric`: The categorical title to display.
- `title`: Slide title.
- `unit`: Unit (e.g., `"%"`).
- `focal_group`: List with `name` and optional `subset`.
- `comparison_groups`: Optional list of groups to compare.

#### Example `instructions` (Slide 6)

```r
instructions <- list(
  list(
    slide             = 6,
    slide_type        = "donut_chart",
    metric            = "jam_type",
    title             = "JAM Type Distribution",
    unit              = "%",
    focal_group       = list(name = "IWF", subset = "All"),
    comparison_groups = NULL
  )
)
```

---

### D. Most Common Activities (High/Low Value)

**Used In**: Slides 23â€“28  

**Function**:  
```r
generate_activity_slide(data, instruction)
```

#### Description

- Injects top 5 activity names and hours into a static PowerPoint template layout for each group.
- The activity names and their corresponding time values are injected directly into labeled placeholders defined in the static slide template.
- The number and layout of groups displayed depend on the structure of the instruction list (Total groups number and targeted `value_type`).

#### Characterstics of the `instruction` input

- `slide`: Slide number.
- `slide_type`: `"activity_slide"`
- `title`: Chart title.
- `value_type`: `"High"` or `"Low"`, to filter activity value levels.
- `focal_group`: List with `name` and optional `subset`.
- `comparison_groups`: Optional list of comparison groups.

#### Example `instructions` (Slide 24)

```r
instructions <- list(
  list(
    slide             = 24,
    slide_type        = "activity_slide",
    title             = "Most Common High Value Activities",
    value_type        = "High",
    focal_group       = list(name = focal_group, subset = "All"),
    comparison_groups = list(
      list(name = comparison_group_1, subset = "All")
    )
  )
)
```

---

### E. Horizontal bar chart 

**Used In**: Slides 53, 54, 69, 70 

**Function**:  
```r
generate_horizontal_bar_slide(data, instruction)
```

#### Description

Creates side-by-side vertical columns grouped by time or status, optionally stacked.

#### Characterstics of the `instruction` input

- `slide`: Slide number.
- `slide_type`: Slide type identifier.
- `metric`: titleiable used to determine the column fill.
- `title`: Title displayed above the chart.
- `unit`: Unit of measurement.
- `x_title`, `y_title`: Axis titles.
- `focal_group`: List with `name` and optional `subset`.
- `comparison_groups`: Optional list of comparison groups and optional `subset`.
- `stacked`: Logical (`TRUE` or `FALSE`) indicating whether columns should be stacked.
- `target`: Optional; target values for reference lines (can be `NULL`).
- `legend`: Logical; whether to display the legend.



#### Example `instructions` (Slide 69)

This example illustrates a comparison between subgroups (Men vs. Women) within the same focal group. Both the focal_group and the comparison_groups reference the same group name, but apply different subset filters. 
This shows the flexibility of the pipeline, which allows intra-group comparisons to be configured through subset logic alone, without requiring distinct group identifiers.

```r
instructions <- list(
  list(
    slide      = 69,
    slide_type = "horizontal_bar",
    metric     = "reunion_class",
    title      = "GENDER AND WORK HOURS (5th - 20th)",
    unit       = "%",
    x_title    = NULL,
    y_title    = "% by Sector",
    focal_group = list(
      name   = focal_group,
      subset = list(
                list(title = "gender", value = "Men")
              )
    ),
    comparison_groups = list(
      name   = focal_group,
      subset = list(
                list(title = "gender", value = "Women")
              )
    )
    stacked = TRUE,
    target  = NULL,
    legend  = TRUE
  )
)

```
#### Example `instructions` (Slide 70)

This example explain the structure of the instructions list to configure a column chart using two levels of subgrouping: gender and parental status (i.e., whether respondents have children).

**Note : Only this type of graph allows two level of sub-grouping.**

```r
instructions <- list(
  list(
    slide      = 69,
    slide_type = "horizontal_bar",
    metric     = "reunion_class",
    title      = "GENDER AND WORK HOURS (5th - 20th)",
    unit       = "%",
    x_title    = NULL,
    y_title    = "% by Sector",

    # Focal group: Men with any parental status
    focal_group = list(
      name   = focal_group,
      subset = list(
        list(title = "gender", value = "Men"),
        list(title = "parental_status", value = "All")
      )
    ),
    # Comparison group: Women with any parental status
    comparison_groups = list(
      list(
        name   = focal_group,
        subset = list(
          list(title = "gender", value = "Women"),
          list(title = "parental_status", value = "All")
        )
      )
    ),
    stacked = TRUE,
    target  = NULL,
    legend  = TRUE
  )
)

```
---

### F. Multi-Line Comparison Chart

**Used In**: Slides 84â€“87  

**Function**:  
```r
generate_line_comparison_slide(data, instruction)
```

#### Description

Draws one or more lines across time, comparing focal and comparison groups.

#### Characterstics of the `instruction` input

- `slide_type`: `"line_comparison_chart"`
- `slide`: Slide number.
- `metric`: titleiable to compare.
- `x_title`: Time or x-axis grouping.
- `y_title`: titleiable used for the y-axis.
- `title`: Chart title.
- `focal_group`: List with `name` and optional `subset`.
- `comparison_groups`: List of groups to compare.

#### Example `instructions` (Slide 84)

```r
instructions <- list(
  list(
    slide_type        = "line_comparison_chart",
    slide             = 84,
    metric            = "life_satisfaction",
    title             = "Life Satisfaction Over Time",
    x_title           = "reunion_class",
    y_title           = "value",
    focal_group       = list(name = "HBS", subset = "Men"),
    comparison_groups = list(
      list(name = "IWF", subset = "Women")
    )
  )
)
```

---

### G. Circle Value Summary

**Used In**: Slides 75â€“78  
**Function**:  
```r
generate_circle_summary_slide(data, instruction)
```

#### Description

Generates circle-shaped summary bubbles displaying numeric values (e.g., average TQI or life satisfaction) for one or more groups.

#### Characterstics of the `instruction` input

- `slide_type`: `"circle_summary_slide"`
- `slide`: Slide number.
- `metric`: titleiable to summarize.
- `title`: Chart title.
- `unit`: Display unit (e.g., `"score"`, `"hours"`).
- `focal_group`: Group to display in primary bubble.
- `comparison_groups`: List of groups to show in smaller bubbles.

#### Example `instructions` (Slide 75)

```r
instructions <- list(
  list(
    slide_type        = "circle_summary_slide",
    slide             = 76,
    metric            = "life_satisfaction",
    title             = "LIFE SATISFACTION",
    unit              = NULL,
    focal_group       = list(name = "HBS", subset = "ALUMNI"),
    comparison_groups = NULL
  )
)
```

---
## Relevant Questions:

####  1. On the fly slide generation:
When generating slides on the fly during a live event, should the pipeline produce a new standalone PowerPoint file, or should it modify an existing pre-generated .pptx?
For example:
We already have a `.pptx` with 50 slides comparing Xilio (focal group from the last event) to HBS (comparison group).
During the live event, the new focal group is XXX, and we want to generate 15 slides comparing XXX vs. HBS, based on on the fly collected data.

Should the pipeline generate a new `.pptx` containing only the 15 slides for new focal group or replace the relevant slides (e.g., density charts) in the existing old focal group `.pptx`, preserving the other original slides?

---
## ðŸ“Œ Constraints and Considerations

### 1. Template Integration

The pipeline will also use some existing PPT templates. Input files will include:
  * Master template (title, header, background, surroundings)
  * Special layout slides (e.g., 1st intro slide, explanation, static visuals)

### 2. Single-Slide Update Capability

**Use case**: Update one slide (e.g., bar height) shortly before an event without altering the other _tweaked_ slides on regeneration.

#### Suggested Approach

* Provide optional targeting via `target_slide_id` corresponding to the order in PPT.
* Regenerate only the matching slide, reinjecting it into the existing `.pptx`

#### Caveats

* Must avoid slide order drift
* Slide identity must remain stable (e.g., naming convention or metadata tagging)
* The usage should be friendly and intuitive
* A _back-up_ logic should be implemented to avoid bad surprises
 
### 3. Visual Safeguards

* For density chart types, consider displaying the Y-axis as percentages rather than decimals, this would enhance readability for most users.
* Ensure average values (e.g., `Avg. = 7.9`) in the green box donâ€™t overlap chart elements. The print should look nice at all times.
* Pie charts must remain readable even for small segments - edge cases
* Other use cases to be discovered during developments

---

## ðŸš§ Next Steps

Once we agree on everything described above, hereâ€™s how we move forward:
1. Define and test the `instructions` list structure, with real examples for each graph type.
2. Build the core slide generation pipeline and make sure it's tested and works end-to-end.
3. Implement the key slide functions:

* `generate_density_slide()`          
* `generate_bar_slide()`              
* `generate_donut_slide()`            
* `generate_horizontal_bar_slide()`   
* `generate_activity_slide()`         
* `generate_line_comparison_slide()`  
* `generate_circle_summary_slide()`

4. Set up GitHub Issues with clear tasks for each function/component.
5. Confirm integration with PPT templates (e.g., base slide, green boxes, intro slides).
6. Implement and test the mechanism to update **a single targeted slide** without regenerating the full deck.
7. Deliver a first version with fully working examples from the actual presentation.

Letâ€™s finalize this structure before diving into code.
