# Automated Slide Deck Generation from Survey Data (Phase 2 & 3)

This README describes the proposed architecture and logic for automating the creation of PowerPoint presentations from structured, preprocessed survey data. It outlines the data structure, slide generation pipeline, individual slide rendering functions, and known constraints based on initial analysis and discussions. This document corresponds to **Phase 2**, and a good starting point of **Phase 3** of the project.

---

## 📊 Data Preprocessing Strategy

### Objective

Instead of coupling data processing with visual generation, we suggest a **clean separation**: pre-calculate all values that will be displayed in the slides and store them in structured tables.

This brings two major advantages:

* **Editability**: Sari can modify target values directly before rendering (e.g., overwrite a mean value in Excel, instead of changing the raw data _to make the average equal to a specific value_).
* **Simplicity**: Keeps slide rendering functions free of calculation logic.

### Overall Workflow Steps

1. Start from raw survey data (CSV/Excel), extracted from the LIFEMATRIX API.
2. Preprocess into structured outputs ready for visual injection.
3. Save all outputs to Excel (one sheet per graph type, for instance, totaling around 6 or 7 sheets).
4. This preprocessed dataset becomes the input to the R-based slide generator.

Both steps (preprocessing + slide generation) are kept modular in the pipeline.

### Example Preprocessed Table (Concept Only)

| metric             | group      | value |
| ------------------ | ---------- | ----- |
| life\_satisfaction | all        | 7.9   |
| life\_satisfaction | HBS\_men   | 7.8   |
| life\_satisfaction | HBS\_women | 7.5   |
| joy\_percent       | xilio      | 85    |
| joy\_percent       | hbs        | 92    |

This structure allows functions to filter and map values clearly.

**❓Feasibility Check for Sari:**

> Can this preprocessing step be formalized and included as part of the pipeline?

---

## 🧩 Global Pipeline Structure

### Inputs

* Preprocessed data (as structured above)
* Instruction list (`instructions`) defining the slide layout and content logic

### Core

* Iterate over the `instructions` list and execute the corresponding slide generative functions

### Output

* A `.pptx` file containing all the slides

### Example Code Usage

```r
# Preprocess data from raw survey
preprocessed_data <- run_data_preproc(fread("raw_data.csv"))

# Define slide instructions
instructions <- list(
  list(fun = "generate_density_slide", variable = "life_satisfaction"),
  list(fun = "generate_bar_slide", metric = "joy_percent", groups = c("xilio", "hbs"))
)

# Run main pipeline
run_pipeline(data = preprocessed_data, instructions = instructions)
```

---

## 🧱 Slide Generative Functions

Each slide is generated by a specific function tailored to its type.

### A. Density Graphs with Average

**Used In**: Slides 3–5, 29–52, 57–58

#### Inputs

* `data`: Preprocessed data
* `variable`: Target variable (e.g., `life_satisfaction`)
* `title`: (optional)
* `xlab`, `ylab`: (optional)
* `average_compare`: (optional) Named list specifying groups to display average for (max 3)

#### Example Usage

```r
generate_density_slide(
  data = preprocessed_data,
  variable = "life_satisfaction",
  average_compare = list(group = "HBS", gender = c("Women", "Men"))
)
```

#### Core Logic

* Plot a density curve of the variable
* If `average_compare` is provided, overlay green box(es) with Avg. values

#### Questions for Validation

1. Is the distribution always shown for the full group?
2. Should the Y-axis show % instead of decimals?
3. Are density graphs the only slide type with this green box?
4. Can we reuse any of Sari's plotting code to preserve style consistency?

---

### B. Bar Graphs

**Used In**: Slides 8–12 and similar

#### Observations

Bar graphs follow repeatable patterns:

* X-axis: fixed categories like "Joy", "Achievement", etc.
* Legend: 1 to 3 items (can include empty elements)
* Always % values, making labels consistent

#### Inputs

* `data`: Preprocessed data
* `title`, `xlab`, `ylab`: (optional)
* `legend_labels`: Character vector (can include `NA`)
* `values`: Named list of metric values per legend

#### Example Instruction (Slide 10)

```r
list(
  fun = "generate_bar_slide",
  metric = "jam_scores",
  legend_labels = c("Xilio", "HBS"),
  values = list(
    Joy = c(85, 92),
    Achievement = c(78, 89),
    Meaningfulness = c(81, 91)
  )
)
```

#### Core Logic

* Map values to a consistent bar chart format
* Add optional reference line(s) if needed

#### Open Questions

* Can all bar chart variants be encapsulated in this logic?
* What about edge-case slides like 56?

---

### C. Most Common Activities (High/Low Value)

**Used In**: Slides with top activity hours

#### Inputs

* Static format? (e.g., always top 5?)
* Fixed groupings? (e.g., Xilio, HBS, etc.)

#### Suggestion

If format is constant, we could use **PPT templates** with pre-positioned text boxes, and only inject values into them.

#### Question

How dynamic are these rankings and groups? Are exceptions expected?

---

## 📌 Constraints and Considerations

### 1. Template Integration

* All generated slides should embed into an existing PPT template.
* Input files will include:

  * Master template (title, header, background)
  * Special layout slides (e.g., intro, explanation, static visuals)

### 2. Single-Slide Update Capability

**Use case**: Update one slide (e.g., bar height) shortly before an event.

#### Suggested Approach

* Provide optional targeting via `target_slide_id`
* Regenerate only the matching slide, reinjecting it into the existing `.pptx`

#### Caveats

* Must avoid slide order drift
* Slide identity must remain stable (e.g., naming convention or metadata tagging)

### 3. Visual Safeguards

* Ensure average values (e.g., `Avg. = 7.9`) don’t overlap chart elements
* Pie charts must remain readable even for small segments

---

## 🚧 Next Steps

1. Validate this README structure with the team
2. Confirm the preprocessing step design with Sari
3. Implement and test `run_data_preproc()` with mock inputs
4. Draft and test the following generators:

   * `generate_density_slide()`
   * `generate_bar_slide()`
5. Set up GitHub Issues per function/module
6. Package the pipelines with robust inputs and template support

---

Let’s finalize this structure before diving into code.

---
